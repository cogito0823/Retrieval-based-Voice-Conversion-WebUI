# RVC WebUI v2 - 产品功能方案 (Product Specification)

## 1. 导航结构 (Navigation)

系统采用左侧侧边栏导航，包含以下模块：

*   **首页 (Dashboard)**: 系统概览，显示硬件状态、最近任务。
*   **离线推理 (Inference)**: 语音转换核心功能。
*   **模型训练 (Training)**: 模型训练全流程管理。
*   **资源库 (Library)**: 本地模型与索引文件管理。
*   **设置 (Settings)**: 全局配置。

---

## 2. 详细页面功能设计

### 2.1 离线推理 (Inference)

此模块采用 **“双视图”** 设计：

#### A. 新建推理 (New Task) - 默认视图
*   **布局**: 左右分栏或居中表单。
*   **Step 1: 选择模型**
    *   展示模型卡片墙（封面图、名称、版本）。
    *   支持搜索和按名称排序。
    *   选中模型后，下方显示该模型的推荐参数（如有）。
*   **Step 2: 上传音频**
    *   拖拽上传区域 (Dropzone)。
    *   支持多选文件。
    *   上传后显示文件列表，每行包含：文件名、大小、时长、**播放按钮**。
*   **Step 3: 参数配置 (高级设置折叠)**
    *   **F0 Method**: 下拉框 (rmvpe, pm, harvest...)，默认 rmvpe。
    *   **Pitch (变调)**: 滑块 + 输入框，范围 -24 ~ +24，默认 0。
    *   **Index Rate**: 滑块，0 ~ 1，默认 0.75。
    *   **其他**: Filter Radius, RMS Mix, Protect 等。
*   **Action**: 底部悬浮或固定按钮 "开始转换 (Convert)"。

#### B. 任务列表 (Task History)
*   **入口**: 顶部 Tab 切换 "历史记录"。
*   **列表项**:
    *   **状态图标**: 排队中(灰色)、进行中(蓝色转圈)、成功(绿色勾)、失败(红色叉)。
    *   **摘要**: 模型名 + 音频名 + 变调参数。
    *   **进度条**: 仅在进行中显示。
    *   **耗时**: e.g., "3.2s"。
    *   **操作区**:
        *   **播放**: 直接试听输出音频。
        *   **波形图**: 点击展开波形对比（原声 vs 转换后）。
        *   **下载**: 下载结果音频。
        *   **重试**: 使用相同参数重新创建任务。

---

### 2.2 模型训练 (Training)

此模块是本次重构的重点，采用 **“向导式 (Wizard)”** 详情页。

#### A. 训练列表 (List View)
*   展示所有训练项目。
*   **卡片信息**: 模型名、当前阶段 (Step 2/4)、最后更新时间、状态标签。
*   **新建按钮**: 点击弹出模态框，输入模型名称、采样率 (40k/48k)、版本 (v2)。

#### B. 训练详情页 (Detail View)

页面顶部为 **步骤条 (Stepper)**：
`1. 数据准备` -> `2. 特征提取` -> `3. 模型训练` -> `4. 导出`

**Step 1: 数据准备 (Data)**
*   **数据集来源**:
    *   Tab 1: **上传压缩包** (拖拽 Zip，后端自动解压)。
    *   Tab 2: **服务器路径** (输入绝对路径，适合大数据集)。
*   **操作**: 填写路径后，点击 "执行预处理"。
*   **反馈**:
    *   显示实时日志终端 (Terminal)。
    *   完成后显示：生成的切片数量。
    *   **抽样试听**: 随机展示 5 个切片供用户检查音质和切割效果。

**Step 2: 特征提取 (Features)**
*   **配置**:
    *   **F0 算法**: 单选按钮组 (rmvpe / crepe / ...)。
    *   **GPU 选择**: 下拉框 (多卡环境下)。
*   **操作**: 点击 "提取特征"。
*   **反馈**:
    *   双进度条：F0 提取进度、Embedding 提取进度。

**Step 3: 训练 (Train)**
*   **配置面板**:
    *   左侧表单：Batch Size, Epochs, Save Interval, FP16, Cache GPU。
    *   底模选择：下拉选择 G/D 预训练模型。
*   **监控面板 (右侧或下方)**:
    *   **图表**: 实时更新的 Loss 曲线 (G_Loss, D_Loss, Mel_Loss)。
    *   **仪表盘**: 当前 Epoch/Total, 当前 Step, 预计剩余时间 (ETA)。
*   **控制栏**:
    *   `开始训练` (Start)
    *   `暂停` (Pause) - 变更为 `继续` (Resume)
    *   `停止` (Stop)

**Step 4: 导出 (Export)**
*   **索引训练**: 点击 "训练索引"，完成后显示 index 文件路径。
*   **模型融合**:
    *   列表展示所有已保存的 Checkpoints (e.g., G_100.pth, G_200.pth)。
    *   选择一个 Checkpoint，点击 "导出模型"。
*   **发布**: 导出成功后，点击 "发布到库"，模型即可在“离线推理”模块中使用。

---

### 2.3 资源库 (Library)

*   **模型管理**:
    *   展示所有 `.pth` 模型文件。
    *   支持修改模型名称、上传封面图片。
    *   支持删除模型。
*   **下载中心**:
    *   提供官方预训练模型 (RVC v2 Base Models) 的下载链接。
    *   一键下载并安装到指定目录。

---

## 3. 全局交互细节

*   **Toast 通知**: 任务完成、错误提示均通过右上角 Toast 弹出。
*   **WebSocket 连接状态**: 界面右下角小红点/绿点，指示与后端的连接状态。
*   **深色模式**: 默认跟随系统，支持手动切换。

## 4. 移动端适配
*   虽然主要面向桌面端，但布局应响应式适配平板尺寸。
*   手机端仅支持“查看状态”和“简单推理”，不支持创建训练任务。
